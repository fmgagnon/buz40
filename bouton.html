<!DOCTYPE html>
<html>
	   <meta charset = "utf-8" />
	      <title>buz40 : bouton</title>
	      
	      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
      <script src="/socket.io/socket.io.js"></script>
      
      <script src="/chemin.js"></script>
      

<script>
	var serveur = io.connect(racineURL);

	// En commençant, le bouton ne sait pas il est à qui, il joue où, ni avec qui.
	var nomJuge = '';
	var nomJoueur = '';
	var msg_juge = '';
	var cherchePlateau = 0;

	// Peut-être a-t-il utilisé l'URL donné par la console?
	const urlParams = new URLSearchParams(window.location.search);
	cherchePlateau = urlParams.get('no');
	
	// Échange avec le serveur pour obtenir un numéro séquentiel de bouton
	var noSeqBouton = undefined;
	serveur.on('quid', function(msg){
		console.log('Reçu numéro ', msg);
		noSeqBouton = msg;
	});

	// Identification du joueur
	function identification() {
		document.getElementById("bouton").style.visibility = "visible";	
		document.getElementById("formulaireID").style.visibility = "hidden";	
		window.nomJoueur = document.getElementById("formJoueur").value;
		window.cherchePlateau = document.getElementById("formPlateau").value;
		nomJoueur.replace(/[.*+?^${}()|[\]\\]/g, '_');
		cherchePlateau.replace(/[.*+?^${}()|[\]\\]/g, '_');
		
		serveur.emit('id_joueur', {	noSeqBouton: noSeqBouton,
									nomJoueur: nomJoueur,
									cherchePlateau: cherchePlateau});
	};

	// Entrée sur un plateau acceptée
	var numeroPlateau = undefined;
	serveur.on('bienvenue', function(msg){
		numeroPlateau = msg.numeroPlateau;
		nomJuge = msg.nomJuge
		window.alert("Bienvenue sur le plateau!", numeroPlateau);
		document.getElementById("nomJuge").innerHTML = nomJuge;
		debutMatch();
	});
	
	// Entrée sur un plateau refusée : affichage d'un message d'erreur
	serveur.on('non_merci', function(msg){
		window.alert("Entrée refusée : " + msg);
		window.location.reload(true);
	});

	// La mécanique du match en tant que tel
	function debutMatch() {
	
		window.plateau = io.connect(racineURL + numeroPlateau);
		plateau.emit('allo', {nomJoueur: nomJoueur, noSeqBouton: noSeqBouton})
		
		// Le message aToi		
		plateau.on('aToi', function(){
			document.getElementById("buzzeur").classList.remove("btn-primary");
			document.getElementById("buzzeur").classList.add("btn-success");
		});
		
		plateau.on('bloque', function(){
			document.getElementById("buzzeur").classList.remove("btn-primary");
			document.getElementById("buzzeur").classList.add("btn-dark");
		});

		plateau.on('auJeu', function(){
			document.getElementById("buzzeur").classList.remove("btn-dark");
			document.getElementById("buzzeur").classList.remove("btn-success");
			document.getElementById("buzzeur").classList.add("btn-primary");
		});

		plateau.on('disconnect', () => {
  			window.alert("Erreur de la console, prière de redémarrer.");
		});

		plateau.on('erreur', () => {
  			window.alert("Erreur de la console, prière de redémarrer.");
		});
 
	};

	function buzz() {

		window.plateau.emit('signal', {nomJoueur: nomJoueur, noSeqBouton: noSeqBouton});
	};


// pas très chic, mais permet de buzzer avec ENTER
	document.addEventListener("keyup", function(event) {
  	// Number 13 is the "Enter" key on the keyboard
  		if (event.keyCode === 13) {
    	// Cancel the default action, if needed
   		 event.preventDefault();
   		 // Trigger the button element with a click
   		 document.getElementById("buzzeur").click();
  }
});

</script>

</head>
  <body>
    <div class="container">




	<div class="container" id="formulaireID" style="visibility: visible">
	    <div class="container">
	         <h1>buz40 : bienvenue!</h1>

        
        
        
        <table border=0><tr valign=bottom>
  			<td>
  				  <label for="formJoueur">Nom</label><br />
  				  <input type="text" class="form-control" id="formJoueur" placeholder="Nom">
  			</td>
  			<td>
  				  <label for="exampleInputEmail2">Plateau</label><br />
  				  <input type="text" class="form-control" id="formPlateau" placeholder="numéro">
 			 </td>
 			 <td>
 		 <button type="button" class="btn btn-primary" onclick="identification();">Accéder</button>
 		 	</td>
 		 	</tr>
</table>
        
        
        
        
        
        
        
    </div>
<script>	document.getElementById("formPlateau").value = cherchePlateau;
</script>
    </div>
    
    
    
    
    	
    <div class="jumbotron" id="bouton" style="visibility: hidden">
      <div class="container">
        <h1>buz40 : match de <span id="nomJuge"></span></h1>

 <button class="btn-primary btn-lg" onClick="buzz();" id="buzzeur" role="button">BUZZ</button></p>

<p><small><strong>Trucs&nbsp;:</strong><br />
Vous pouvez utiliser <key>Entrée</key> pour buzzer. <br />
Si vous utilisez la souris, la combinaison <kbd>Ctrl</kbd>+<kbd>+</kbd> pourrait être utile pour faire grossir le bouton. </small></p> 
      </div>
    </div>

         
</body>         
</html>




    
  </body>
</html>